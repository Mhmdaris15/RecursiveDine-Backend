server {
    listen 443 ssl;
    server_name recursive-tech.site www.recursive-tech.site;
    ssl_certificate /etc/letsencrypt/live/recursive-tech.site/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/recursive-tech.site/privkey.pem; # managed by Certbot

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256';

    location = / {
        proxy_pass http://localhost:8080/app;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /zerbx {
        proxy_pass http://localhost:8080/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location / {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }   
}

# ragemini subdomain
server {
    listen 443 ssl;
    server_name ragemini.recursive-tech.site;
    ssl_certificate /etc/letsencrypt/live/recursive-tech.site/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/recursive-tech.site/privkey.pem; # managed by Certbot

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256';

    location / {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 300s;
        proxy_connect_timeout 300s;
    }
    client_max_body_size 100M;
    client_body_buffer_size 128k;
}

# mitraperdanaservice subdomain
server {
    listen 443 ssl;
    server_name mitraperdanaservice.recursive-tech.site;
    ssl_certificate /etc/letsencrypt/live/recursive-tech.site/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/recursive-tech.site/privkey.pem; # managed by Certbot

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256';

    location / {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 300s;
        proxy_connect_timeout 300s;
    }
    client_max_body_size 100M;
    client_body_buffer_size 128k;
}

# n8n subdomain
server {
    listen 443 ssl;
    server_name n8n.recursive-tech.site;
    ssl_certificate /etc/letsencrypt/live/recursive-tech.site/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/recursive-tech.site/privkey.pem; # managed by Certbot

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256';

    location / {
        proxy_pass http://localhost:5678;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 300s;
        proxy_connect_timeout 300s;
    }
    client_max_body_size 100M;
    client_body_buffer_size 128k;
}

# report-ragemini subdomain
server {
    listen 443 ssl;
    server_name report-ragemini.recursive-tech.site;
    ssl_certificate /etc/letsencrypt/live/recursive-tech.site/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/recursive-tech.site/privkey.pem; # managed by Certbot

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256';

    location / {
        proxy_pass http://localhost:7860;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 300s;
        proxy_connect_timeout 300s;
    }
    client_max_body_size 100M;
    client_body_buffer_size 128k;
}

# api.recursivedine subdomain (NEW)
server {
    listen 443 ssl;
    server_name api.recursivedine.recursive-tech.site;
    ssl_certificate /etc/letsencrypt/live/recursive-tech.site/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/recursive-tech.site/privkey.pem; # managed by Certbot

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256';

    location / {
        proxy_pass http://localhost:8002;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 300s;
        proxy_connect_timeout 300s;
    }
    client_max_body_size 100M;
    client_body_buffer_size 128k;
}

# grafana.recursivedine subdomain
server {
    listen 443 ssl;
    server_name grafana.recursivedine.recursive-tech.site;
    ssl_certificate /etc/letsencrypt/live/recursive-tech.site/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/recursive-tech.site/privkey.pem; # managed by Certbot

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256';

    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 300s;
        proxy_connect_timeout 300s;
    }
    client_max_body_size 100M;
    client_body_buffer_size 128k;
}

# prometheus.recursivedine subdomain
server {
    listen 443 ssl;
    server_name prometheus.recursivedine.recursive-tech.site;
    ssl_certificate /etc/letsencrypt/live/recursive-tech.site/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/recursive-tech.site/privkey.pem; # managed by Certbot

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256';

    location / {
        # proxy_pass http://localhost:9090;
        proxy_pass http://localhost:3005;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 300s;
        proxy_connect_timeout 300s;
    }
    client_max_body_size 100M;
    client_body_buffer_size 128k;
}

# jaga-wana subdomain
server {
    listen 443 ssl;
    server_name jaga-wana.recursive-tech.site;
    ssl_certificate /etc/letsencrypt/live/recursive-tech.site/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/recursive-tech.site/privkey.pem; # managed by Certbot

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256';

    location / {
        proxy_pass http://localhost:3005;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 300s;
        proxy_connect_timeout 300s;
    }
    client_max_body_size 100M;
    client_body_buffer_size 128k;
}

# api.tresno-boedoyo subdomain
server {
    listen 443 ssl;
    server_name api.tresno-boedoyo.recursive-tech.site;
    ssl_certificate /etc/letsencrypt/live/recursive-tech.site/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/recursive-tech.site/privkey.pem; # managed by Certbot

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256';

    location / {
        proxy_pass http://localhost:3001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 300s;
        proxy_connect_timeout 300s;
    }
    client_max_body_size 100M;
    client_body_buffer_size 128k;
}

# tresno-boedoyo subdomain
server {
    listen 443 ssl;
    server_name tresno-boedoyo.recursive-tech.site;
    ssl_certificate /etc/letsencrypt/live/recursive-tech.site/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/recursive-tech.site/privkey.pem; # managed by Certbot

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256';

    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 300s;
        proxy_connect_timeout 300s;
    }
    client_max_body_size 100M;
    client_body_buffer_size 128k;
}

# HTTP to HTTPS redirect for ALL domains
server {
    if ($host = api.recursivedine.recursive-tech.site) {
        return 301 https://$host$request_uri;
    } # managed by Certbot

    if ($host = grafana.recursivedine.recursive-tech.site) {
        return 301 https://$host$request_uri;
    }

    if ($host = prometheus.recursivedine.recursive-tech.site) {
        return 301 https://$host$request_uri;
    }

    if ($host = jaga-wana.recursive-tech.site) {
        return 301 https://$host$request_uri;
    }

    if ($host = api.tresno-boedoyo.recursive-tech.site) {
        return 301 https://$host$request_uri;
    }

    if ($host = tresno-boedoyo.recursive-tech.site) {
        return 301 https://$host$request_uri;
    }

    if ($host = report-ragemini.recursive-tech.site) {
        return 301 https://$host$request_uri;
    }

    if ($host = n8n.recursive-tech.site) {
        return 301 https://$host$request_uri;
    }

    if ($host = mitraperdanaservice.recursive-tech.site) {
        return 301 https://$host$request_uri;
    }

    if ($host = ragemini.recursive-tech.site) {
        return 301 https://$host$request_uri;
    }

    if ($host = www.recursive-tech.site) {
        return 301 https://$host$request_uri;
    }

    if ($host = recursive-tech.site) {
        return 301 https://$host$request_uri;
    }

    listen 80;
    server_name recursive-tech.site www.recursive-tech.site 
               ragemini.recursive-tech.site 
               mitraperdanaservice.recursive-tech.site
               n8n.recursive-tech.site
               report-ragemini.recursive-tech.site
               api.recursivedine.recursive-tech.site
               grafana.recursivedine.recursive-tech.site
               prometheus.recursivedine.recursive-tech.site
               jaga-wana.recursive-tech.site
               api.tresno-boedoyo.recursive-tech.site
               tresno-boedoyo.recursive-tech.site;
    return 301 https://$host$request_uri;
}

# sudo certbot --nginx -d recursive-tech.site -d www.recursive-tech.site \
#              -d ragemini.recursive-tech.site \
#              -d mitraperdanaservice.recursive-tech.site \
#              -d n8n.recursive-tech.site \
#              -d report-ragemini.recursive-tech.site \
#              -d api.recursivedine.recursive-tech.site \
#              -d grafana.recursivedine.recursive-tech.site \
#              -d prometheus.recursivedine.recursive-tech.site \
#              -d jaga-wana.recursive-tech.site \
#              -d api.tresno-boedoyo.recursive-tech.site \
#              -d tresno-boedoyo.recursive-tech.site


# sudo certbot --nginx -d jaga-wana.recursive-tech.site